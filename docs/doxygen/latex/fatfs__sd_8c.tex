\doxysection{Middlewares/gwtonn/fatfs\+\_\+sd.c File Reference}
\hypertarget{fatfs__sd_8c}{}\label{fatfs__sd_8c}\index{Middlewares/gwtonn/fatfs\_sd.c@{Middlewares/gwtonn/fatfs\_sd.c}}


Implementation of the SPI SD Card driver for Fat\+Fs.  


{\ttfamily \#include "{}stm32f4xx\+\_\+hal.\+h"{}}\newline
{\ttfamily \#include "{}diskio.\+h"{}}\newline
{\ttfamily \#include "{}fatfs\+\_\+sd.\+h"{}}\newline
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{fatfs__sd_8c_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}}~1
\item 
\#define \mbox{\hyperlink{fatfs__sd_8c_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}}~0
\item 
\#define \mbox{\hyperlink{fatfs__sd_8c_abb452686968e48b67397da5f97445f5b}{bool}}~BYTE
\item 
\#define \mbox{\hyperlink{fatfs__sd_8c_aa0ea6263aeeeae2c7091c9de81f078c0}{HSPI\+\_\+\+SDCARD}}~\&hspi1
\item 
\#define \mbox{\hyperlink{fatfs__sd_8c_a5f934a7642239adfef3e9607d3ad16bc}{SD\+\_\+\+CS\+\_\+\+PORT}}~GPIOA
\item 
\#define \mbox{\hyperlink{fatfs__sd_8c_a04d57a6c18b2d5e81f31093e58ed0c62}{SD\+\_\+\+CS\+\_\+\+PIN}}~GPIO\+\_\+\+PIN\+\_\+4
\item 
\#define \mbox{\hyperlink{fatfs__sd_8c_a0131f2774f4e3dd71567400683b60405}{SPI\+\_\+\+TIMEOUT}}~100
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
DSTATUS \mbox{\hyperlink{fatfs__sd_8c_a2a9756a0824608cafe4795652996c999}{SD\+\_\+disk\+\_\+initialize}} (BYTE drv)
\begin{DoxyCompactList}\small\item\em Initialize the disk drive. \end{DoxyCompactList}\item 
DSTATUS \mbox{\hyperlink{fatfs__sd_8c_aab274cdd8e1c1d404ed23ed3ab08af7f}{SD\+\_\+disk\+\_\+status}} (BYTE drv)
\begin{DoxyCompactList}\small\item\em Get the disk status. \end{DoxyCompactList}\item 
DRESULT \mbox{\hyperlink{fatfs__sd_8c_af48460111fe5bb4f17ef7a44960aca5f}{SD\+\_\+disk\+\_\+read}} (BYTE pdrv, BYTE \texorpdfstring{$\ast$}{*}buff, DWORD sector, UINT count)
\begin{DoxyCompactList}\small\item\em Read sector(s) from the drive. \end{DoxyCompactList}\item 
DRESULT \mbox{\hyperlink{fatfs__sd_8c_ad9dda39726dcb45694f3da737df6baae}{SD\+\_\+disk\+\_\+ioctl}} (BYTE drv, BYTE ctrl, void \texorpdfstring{$\ast$}{*}buff)
\begin{DoxyCompactList}\small\item\em I/O control operation for the drive. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
SPI\+\_\+\+Handle\+Type\+Def \mbox{\hyperlink{fatfs__sd_8c_a9c6222bae4d0328dd843ae099623b40b}{hspi1}}
\item 
volatile uint16\+\_\+t \mbox{\hyperlink{fatfs__sd_8c_aa68d0f4bf591b8c1486383e76b3cc4fd}{Timer1}}
\item 
volatile uint16\+\_\+t \mbox{\hyperlink{fatfs__sd_8c_a5bc0b5f9e08ce3274413c1790df5bc48}{Timer2}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Implementation of the SPI SD Card driver for Fat\+Fs. 

\begin{DoxyAttention}{Attention}

\end{DoxyAttention}
Copyright (c) 2025 Ge Wit\textquotesingle{}t Oit Noit Nie. All rights reserved.

This software is licensed under terms that can be found in the LICENSE file in the root directory of this software component. If no LICENSE file comes with this software, it is provided AS-\/\+IS. 

Definition in file \mbox{\hyperlink{fatfs__sd_8c_source}{fatfs\+\_\+sd.\+c}}.



\doxysubsection{Macro Definition Documentation}
\Hypertarget{fatfs__sd_8c_abb452686968e48b67397da5f97445f5b}\index{fatfs\_sd.c@{fatfs\_sd.c}!bool@{bool}}
\index{bool@{bool}!fatfs\_sd.c@{fatfs\_sd.c}}
\doxysubsubsection{\texorpdfstring{bool}{bool}}
{\footnotesize\ttfamily \label{fatfs__sd_8c_abb452686968e48b67397da5f97445f5b} 
\#define bool~BYTE}



Definition at line \mbox{\hyperlink{fatfs__sd_8c_source_l00020}{20}} of file \mbox{\hyperlink{fatfs__sd_8c_source}{fatfs\+\_\+sd.\+c}}.

\Hypertarget{fatfs__sd_8c_aa93f0eb578d23995850d61f7d61c55c1}\index{fatfs\_sd.c@{fatfs\_sd.c}!FALSE@{FALSE}}
\index{FALSE@{FALSE}!fatfs\_sd.c@{fatfs\_sd.c}}
\doxysubsubsection{\texorpdfstring{FALSE}{FALSE}}
{\footnotesize\ttfamily \label{fatfs__sd_8c_aa93f0eb578d23995850d61f7d61c55c1} 
\#define FALSE~0}



Definition at line \mbox{\hyperlink{fatfs__sd_8c_source_l00019}{19}} of file \mbox{\hyperlink{fatfs__sd_8c_source}{fatfs\+\_\+sd.\+c}}.

\Hypertarget{fatfs__sd_8c_aa0ea6263aeeeae2c7091c9de81f078c0}\index{fatfs\_sd.c@{fatfs\_sd.c}!HSPI\_SDCARD@{HSPI\_SDCARD}}
\index{HSPI\_SDCARD@{HSPI\_SDCARD}!fatfs\_sd.c@{fatfs\_sd.c}}
\doxysubsubsection{\texorpdfstring{HSPI\_SDCARD}{HSPI\_SDCARD}}
{\footnotesize\ttfamily \label{fatfs__sd_8c_aa0ea6263aeeeae2c7091c9de81f078c0} 
\#define HSPI\+\_\+\+SDCARD~\&hspi1}



Definition at line \mbox{\hyperlink{fatfs__sd_8c_source_l00027}{27}} of file \mbox{\hyperlink{fatfs__sd_8c_source}{fatfs\+\_\+sd.\+c}}.

\Hypertarget{fatfs__sd_8c_a04d57a6c18b2d5e81f31093e58ed0c62}\index{fatfs\_sd.c@{fatfs\_sd.c}!SD\_CS\_PIN@{SD\_CS\_PIN}}
\index{SD\_CS\_PIN@{SD\_CS\_PIN}!fatfs\_sd.c@{fatfs\_sd.c}}
\doxysubsubsection{\texorpdfstring{SD\_CS\_PIN}{SD\_CS\_PIN}}
{\footnotesize\ttfamily \label{fatfs__sd_8c_a04d57a6c18b2d5e81f31093e58ed0c62} 
\#define SD\+\_\+\+CS\+\_\+\+PIN~GPIO\+\_\+\+PIN\+\_\+4}



Definition at line \mbox{\hyperlink{fatfs__sd_8c_source_l00029}{29}} of file \mbox{\hyperlink{fatfs__sd_8c_source}{fatfs\+\_\+sd.\+c}}.

\Hypertarget{fatfs__sd_8c_a5f934a7642239adfef3e9607d3ad16bc}\index{fatfs\_sd.c@{fatfs\_sd.c}!SD\_CS\_PORT@{SD\_CS\_PORT}}
\index{SD\_CS\_PORT@{SD\_CS\_PORT}!fatfs\_sd.c@{fatfs\_sd.c}}
\doxysubsubsection{\texorpdfstring{SD\_CS\_PORT}{SD\_CS\_PORT}}
{\footnotesize\ttfamily \label{fatfs__sd_8c_a5f934a7642239adfef3e9607d3ad16bc} 
\#define SD\+\_\+\+CS\+\_\+\+PORT~GPIOA}



Definition at line \mbox{\hyperlink{fatfs__sd_8c_source_l00028}{28}} of file \mbox{\hyperlink{fatfs__sd_8c_source}{fatfs\+\_\+sd.\+c}}.

\Hypertarget{fatfs__sd_8c_a0131f2774f4e3dd71567400683b60405}\index{fatfs\_sd.c@{fatfs\_sd.c}!SPI\_TIMEOUT@{SPI\_TIMEOUT}}
\index{SPI\_TIMEOUT@{SPI\_TIMEOUT}!fatfs\_sd.c@{fatfs\_sd.c}}
\doxysubsubsection{\texorpdfstring{SPI\_TIMEOUT}{SPI\_TIMEOUT}}
{\footnotesize\ttfamily \label{fatfs__sd_8c_a0131f2774f4e3dd71567400683b60405} 
\#define SPI\+\_\+\+TIMEOUT~100}



Definition at line \mbox{\hyperlink{fatfs__sd_8c_source_l00030}{30}} of file \mbox{\hyperlink{fatfs__sd_8c_source}{fatfs\+\_\+sd.\+c}}.

\Hypertarget{fatfs__sd_8c_aa8cecfc5c5c054d2875c03e77b7be15d}\index{fatfs\_sd.c@{fatfs\_sd.c}!TRUE@{TRUE}}
\index{TRUE@{TRUE}!fatfs\_sd.c@{fatfs\_sd.c}}
\doxysubsubsection{\texorpdfstring{TRUE}{TRUE}}
{\footnotesize\ttfamily \label{fatfs__sd_8c_aa8cecfc5c5c054d2875c03e77b7be15d} 
\#define TRUE~1}



Definition at line \mbox{\hyperlink{fatfs__sd_8c_source_l00018}{18}} of file \mbox{\hyperlink{fatfs__sd_8c_source}{fatfs\+\_\+sd.\+c}}.



\doxysubsection{Function Documentation}
\Hypertarget{fatfs__sd_8c_a2a9756a0824608cafe4795652996c999}\index{fatfs\_sd.c@{fatfs\_sd.c}!SD\_disk\_initialize@{SD\_disk\_initialize}}
\index{SD\_disk\_initialize@{SD\_disk\_initialize}!fatfs\_sd.c@{fatfs\_sd.c}}
\doxysubsubsection{\texorpdfstring{SD\_disk\_initialize()}{SD\_disk\_initialize()}}
{\footnotesize\ttfamily \label{fatfs__sd_8c_a2a9756a0824608cafe4795652996c999} 
DSTATUS SD\+\_\+disk\+\_\+initialize (\begin{DoxyParamCaption}\item[{BYTE}]{pdrv}{}\end{DoxyParamCaption})}



Initialize the disk drive. 

Initializes the disk drive 
\begin{DoxyParams}{Parameters}
{\em pdrv} & Physical drive number to identify the drive \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em Result} & of the operation \\
\hline
\end{DoxyRetVals}


Definition at line \mbox{\hyperlink{fatfs__sd_8c_source_l00268}{268}} of file \mbox{\hyperlink{fatfs__sd_8c_source}{fatfs\+\_\+sd.\+c}}.

\Hypertarget{fatfs__sd_8c_ad9dda39726dcb45694f3da737df6baae}\index{fatfs\_sd.c@{fatfs\_sd.c}!SD\_disk\_ioctl@{SD\_disk\_ioctl}}
\index{SD\_disk\_ioctl@{SD\_disk\_ioctl}!fatfs\_sd.c@{fatfs\_sd.c}}
\doxysubsubsection{\texorpdfstring{SD\_disk\_ioctl()}{SD\_disk\_ioctl()}}
{\footnotesize\ttfamily \label{fatfs__sd_8c_ad9dda39726dcb45694f3da737df6baae} 
DRESULT SD\+\_\+disk\+\_\+ioctl (\begin{DoxyParamCaption}\item[{BYTE}]{pdrv}{, }\item[{BYTE}]{cmd}{, }\item[{void \texorpdfstring{$\ast$}{*}}]{buff}{}\end{DoxyParamCaption})}



I/O control operation for the drive. 

I/O control operation for the drive 
\begin{DoxyParams}{Parameters}
{\em pdrv} & Physical drive number to identify the drive \\
\hline
{\em cmd} & Control code \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{fatfs__sd_8c_source_l00472}{472}} of file \mbox{\hyperlink{fatfs__sd_8c_source}{fatfs\+\_\+sd.\+c}}.

\Hypertarget{fatfs__sd_8c_af48460111fe5bb4f17ef7a44960aca5f}\index{fatfs\_sd.c@{fatfs\_sd.c}!SD\_disk\_read@{SD\_disk\_read}}
\index{SD\_disk\_read@{SD\_disk\_read}!fatfs\_sd.c@{fatfs\_sd.c}}
\doxysubsubsection{\texorpdfstring{SD\_disk\_read()}{SD\_disk\_read()}}
{\footnotesize\ttfamily \label{fatfs__sd_8c_af48460111fe5bb4f17ef7a44960aca5f} 
DRESULT SD\+\_\+disk\+\_\+read (\begin{DoxyParamCaption}\item[{BYTE}]{pdrv}{, }\item[{BYTE \texorpdfstring{$\ast$}{*}}]{buff}{, }\item[{DWORD}]{sector}{, }\item[{UINT}]{count}{}\end{DoxyParamCaption})}



Read sector(s) from the drive. 

Reads sector(s) from the drive 
\begin{DoxyParams}{Parameters}
{\em pdrv} & Physical drive number to identify the drive \\
\hline
{\em buff} & Pointer to the data buffer to store read data \\
\hline
{\em sector} & Start sector number to read from \\
\hline
{\em count} & Number of sectors to read \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em Result} & of the operation \\
\hline
\end{DoxyRetVals}


Definition at line \mbox{\hyperlink{fatfs__sd_8c_source_l00375}{375}} of file \mbox{\hyperlink{fatfs__sd_8c_source}{fatfs\+\_\+sd.\+c}}.

\Hypertarget{fatfs__sd_8c_aab274cdd8e1c1d404ed23ed3ab08af7f}\index{fatfs\_sd.c@{fatfs\_sd.c}!SD\_disk\_status@{SD\_disk\_status}}
\index{SD\_disk\_status@{SD\_disk\_status}!fatfs\_sd.c@{fatfs\_sd.c}}
\doxysubsubsection{\texorpdfstring{SD\_disk\_status()}{SD\_disk\_status()}}
{\footnotesize\ttfamily \label{fatfs__sd_8c_aab274cdd8e1c1d404ed23ed3ab08af7f} 
DSTATUS SD\+\_\+disk\+\_\+status (\begin{DoxyParamCaption}\item[{BYTE}]{pdrv}{}\end{DoxyParamCaption})}



Get the disk status. 

Gets the disk status for the disk drive 
\begin{DoxyParams}{Parameters}
{\em pdrv} & Physical drive number to identify the drive \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em Disk} & status \\
\hline
\end{DoxyRetVals}


Definition at line \mbox{\hyperlink{fatfs__sd_8c_source_l00368}{368}} of file \mbox{\hyperlink{fatfs__sd_8c_source}{fatfs\+\_\+sd.\+c}}.



\doxysubsection{Variable Documentation}
\Hypertarget{fatfs__sd_8c_a9c6222bae4d0328dd843ae099623b40b}\index{fatfs\_sd.c@{fatfs\_sd.c}!hspi1@{hspi1}}
\index{hspi1@{hspi1}!fatfs\_sd.c@{fatfs\_sd.c}}
\doxysubsubsection{\texorpdfstring{hspi1}{hspi1}}
{\footnotesize\ttfamily \label{fatfs__sd_8c_a9c6222bae4d0328dd843ae099623b40b} 
SPI\+\_\+\+Handle\+Type\+Def hspi1\hspace{0.3cm}{\ttfamily [extern]}}



Definition at line \mbox{\hyperlink{spi_8c_source_l00027}{27}} of file \mbox{\hyperlink{spi_8c_source}{spi.\+c}}.

\Hypertarget{fatfs__sd_8c_aa68d0f4bf591b8c1486383e76b3cc4fd}\index{fatfs\_sd.c@{fatfs\_sd.c}!Timer1@{Timer1}}
\index{Timer1@{Timer1}!fatfs\_sd.c@{fatfs\_sd.c}}
\doxysubsubsection{\texorpdfstring{Timer1}{Timer1}}
{\footnotesize\ttfamily \label{fatfs__sd_8c_aa68d0f4bf591b8c1486383e76b3cc4fd} 
volatile uint16\+\_\+t Timer1\hspace{0.3cm}{\ttfamily [extern]}}



Definition at line \mbox{\hyperlink{stm32f4xx__it_8c_source_l00056}{56}} of file \mbox{\hyperlink{stm32f4xx__it_8c_source}{stm32f4xx\+\_\+it.\+c}}.

\Hypertarget{fatfs__sd_8c_a5bc0b5f9e08ce3274413c1790df5bc48}\index{fatfs\_sd.c@{fatfs\_sd.c}!Timer2@{Timer2}}
\index{Timer2@{Timer2}!fatfs\_sd.c@{fatfs\_sd.c}}
\doxysubsubsection{\texorpdfstring{Timer2}{Timer2}}
{\footnotesize\ttfamily \label{fatfs__sd_8c_a5bc0b5f9e08ce3274413c1790df5bc48} 
volatile uint16\+\_\+t Timer2}



Definition at line \mbox{\hyperlink{fatfs__sd_8c_source_l00032}{32}} of file \mbox{\hyperlink{fatfs__sd_8c_source}{fatfs\+\_\+sd.\+c}}.

