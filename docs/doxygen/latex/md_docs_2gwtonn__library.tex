\chapter{Ge Wit\textquotesingle{}t Oit Noit Nie bibliotheek}
\hypertarget{md_docs_2gwtonn__library}{}\label{md_docs_2gwtonn__library}\index{Ge Wit\textquotesingle{}t Oit Noit Nie bibliotheek@{Ge Wit\textquotesingle{}t Oit Noit Nie bibliotheek}}
\label{md_docs_2gwtonn__library_autotoc_md9}%
\Hypertarget{md_docs_2gwtonn__library_autotoc_md9}%
\hypertarget{md_docs_2gwtonn__library_autotoc_md10}{}\doxysection{\texorpdfstring{SD Card Logger -\/ Free\+RTOS implementation}{SD Card Logger -\/ Free\+RTOS implementation}}\label{md_docs_2gwtonn__library_autotoc_md10}
De {\ttfamily sd\+\_\+logger} implementeerd functionaliteiten om een log te schrijven op een SD kaart (Via de SPI Interface).

De {\ttfamily void start\+Log\+Task(void \texorpdfstring{$\ast$}{*}argument)} is geimplementeerd in the bilbiotheek. De functie is {\ttfamily \+\_\+\+\_\+weak} gemaakt in {\ttfamily \doxylink{freertos_8c_source}{freertos.\+c}}. Om dit te laten werken, is in de STM32\+Cube\+MX programma een Free\+RTOS taak gemaakt met de naam {\bfseries{log\+Task}} en de functie {\ttfamily start\+Log\+Task}. De {\bfseries{Code Generation Option}} is ingesteld op {\bfseries{As Weak}}.\hypertarget{md_docs_2gwtonn__library_autotoc_md11}{}\doxysection{\texorpdfstring{Message mechanisme}{Message mechanisme}}\label{md_docs_2gwtonn__library_autotoc_md11}
Om een berichte te schrijven op de SD kaart, kan een specifieke wachtrij gevuld worden. Deze rij heet {\bfseries{logger\+Queue}}. De queue wordt uitmatisch gemaakt bij het schrijven van de broncode vanuit STM32\+Cube\+MX.

Om een bericht te sturen moet je {\ttfamily \doxylink{sd__logger_8h_source}{sd\+\_\+logger.\+h}} laden in de c code. Daarna kan de volgende code toegevoegd worden\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\ \mbox{\hyperlink{struct_m_s_g_q_u_e_u_e___o_b_j__t}{MSGQUEUE\_OBJ\_t}}\ msg;}
\DoxyCodeLine{}
\DoxyCodeLine{msg.index=1;}
\DoxyCodeLine{msg.message\ =\ \textcolor{charliteral}{'A'};}
\DoxyCodeLine{osMessageQueuePut(loggerQueueHandle,\ \&msg,\ 0,\ 0U);}

\end{DoxyCode}
\hypertarget{md_docs_2gwtonn__library_autotoc_md12}{}\doxysection{\texorpdfstring{Programma controller}{Programma controller}}\label{md_docs_2gwtonn__library_autotoc_md12}
Voor het uitvoeren van de programma, is er een programma controller. De details staan beschreven in \doxysectlink{md_docs_2programma}{programma.md}{0}.\hypertarget{md_docs_2gwtonn__library_autotoc_md13}{}\doxysection{\texorpdfstring{Fat\+FS met de SD Card Controller via SPI}{Fat\+FS met de SD Card Controller via SPI}}\label{md_docs_2gwtonn__library_autotoc_md13}
Om bestanden te kunnen maken op een SD kaart, gebruiken we een SD Card reader. Deze wordt aangesloten via een SPI Interface met de Nucleo board. Vervolgens gebruiken we de Fat\+FS library om een bestandsysteem te simuleren.

De Fat\+FS staat aangemerkt als {\ttfamily USER\+\_\+\+Driver} in STM32\+Cube\+MX. Deze userdriver is gedefineerd in \href{../FATFS/Target/user_diskio.h}{\texttt{ user\+\_\+diskio.\+h}} en geimplementeerd in \href{../FATFS/Target/user_diskio.c}{\texttt{ user\+\_\+diskio.\+c}}.

De vertaalslag van de FATFS implentatie naar SPI commando\textquotesingle{}s gebeurt in \href{../Middlewares/gwtonn/fatfs_sd.c}{\texttt{ fatfs\+\_\+sd.\+c}}. 